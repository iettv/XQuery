import module namespace constants = "http://www.TheIET.org/constants"   at "/Utils/constants.xqy";
let $doiPre := "10.1049/iet-tv.vn."
let $Videos := <video><no>31</no><no>1021</no><no>1022</no><no>1023</no><no>1024</no><no>1189</no><no>1750</no><no>2150</no><no>2215</no><no>2216</no><no>2219</no><no>2269</no><no>2270</no><no>2305</no><no>2306</no><no>2307</no><no>2308</no><no>2331</no><no>2334</no><no>2350</no><no>2361</no><no>2362</no><no>2386</no><no>2387</no><no>2388</no><no>2389</no><no>2390</no><no>2395</no><no>2396</no><no>2397</no><no>2398</no><no>2400</no><no>2407</no><no>2408</no><no>2409</no><no>2410</no><no>2411</no><no>2412</no><no>2413</no><no>2414</no><no>2415</no><no>2416</no><no>2421</no><no>2423</no><no>2428</no><no>2452</no><no>2453</no><no>2457</no><no>2458</no><no>2459</no><no>2460</no><no>2461</no><no>2462</no><no>2463</no><no>2464</no><no>2465</no><no>2466</no><no>2467</no><no>2493</no><no>2494</no><no>2532</no><no>2533</no><no>2566</no><no>2569</no><no>2572</no><no>2612</no><no>2688</no><no>2760</no><no>2813</no><no>2832</no><no>2836</no><no>2837</no><no>2863</no><no>2879</no><no>2910</no><no>2911</no><no>2912</no><no>2913</no><no>2942</no><no>2944</no><no>2946</no><no>2951</no><no>2954</no><no>3002</no><no>3003</no><no>3004</no><no>3005</no><no>3031</no><no>3063</no><no>3064</no><no>3124</no><no>3171</no><no>3172</no><no>3176</no><no>3190</no><no>3223</no><no>3225</no><no>3226</no><no>3227</no><no>3230</no><no>3232</no><no>3233</no><no>3234</no><no>3235</no><no>3250</no><no>3282</no><no>3284</no><no>3285</no><no>3291</no><no>3308</no><no>3370</no><no>3377</no><no>3378</no><no>3422</no><no>3517</no><no>3575</no><no>3596</no><no>3661</no><no>3663</no><no>3672</no><no>3673</no><no>3692</no><no>3740</no><no>3745</no><no>3753</no><no>3770</no><no>3776</no><no>3787</no><no>3795</no><no>3802</no><no>3853</no><no>3854</no><no>3859</no><no>3860</no><no>3862</no><no>3939</no><no>3978</no><no>3979</no><no>3980</no><no>3981</no><no>3982</no><no>3983</no><no>3984</no><no>3985</no><no>3986</no><no>3987</no><no>3988</no><no>3989</no><no>3990</no><no>3991</no><no>3992</no><no>3993</no><no>4036</no><no>4057</no><no>4058</no><no>4061</no><no>4126</no><no>4127</no><no>4128</no><no>4129</no><no>4130</no><no>4131</no><no>4132</no><no>4133</no><no>4134</no><no>4135</no><no>4136</no><no>4137</no><no>4138</no><no>4139</no><no>4140</no><no>4141</no><no>4143</no><no>4144</no><no>4147</no><no>4148</no><no>4152</no><no>4153</no><no>4176</no><no>4192</no><no>4196</no><no>4205</no><no>4212</no><no>4213</no><no>4214</no><no>4215</no><no>4221</no><no>4249</no><no>4272</no><no>4273</no><no>4274</no><no>4275</no><no>4276</no><no>4277</no><no>4279</no><no>4280</no><no>4290</no><no>4319</no><no>4333</no><no>4386</no><no>4390</no><no>4412</no><no>4414</no><no>4428</no><no>4430</no><no>4441</no><no>4443</no><no>4445</no><no>4446</no><no>4447</no><no>4468</no><no>4469</no><no>4470</no><no>4474</no><no>4475</no><no>4477</no><no>4478</no><no>4480</no><no>4504</no><no>4505</no><no>4506</no><no>4507</no><no>4508</no><no>4509</no><no>4510</no><no>4511</no><no>4513</no><no>4515</no><no>4516</no><no>4520</no><no>4529</no><no>4531</no><no>4534</no><no>4535</no><no>4539</no><no>4540</no><no>4541</no><no>4543</no><no>4548</no><no>4609</no><no>4610</no><no>4622</no><no>4623</no><no>4624</no><no>4632</no><no>4661</no><no>4767</no><no>4770</no><no>4789</no><no>4792</no><no>4793</no><no>4817</no><no>4818</no><no>4819</no><no>4826</no><no>4828</no><no>4831</no><no>4832</no><no>4834</no><no>4836</no><no>4837</no><no>4838</no><no>4839</no><no>4840</no><no>4841</no><no>4843</no><no>4845</no><no>4847</no><no>4848</no><no>4850</no><no>4855</no><no>4856</no><no>4857</no><no>4858</no><no>4859</no><no>4860</no><no>4861</no><no>4869</no><no>4878</no><no>4880</no><no>4883</no><no>4886</no><no>4887</no><no>4888</no><no>4889</no><no>4892</no><no>4893</no><no>4894</no><no>4895</no><no>4924</no><no>4925</no><no>4926</no><no>4930</no><no>4931</no><no>4933</no><no>4935</no><no>4936</no><no>4939</no><no>4940</no><no>4941</no><no>4942</no><no>4943</no><no>4949</no><no>4950</no><no>4951</no><no>4952</no><no>4953</no><no>4954</no><no>4955</no><no>4956</no><no>4957</no><no>4958</no><no>4959</no><no>4960</no><no>4961</no><no>4962</no><no>4963</no><no>4964</no><no>4965</no><no>4966</no><no>4967</no><no>4968</no><no>4969</no><no>4970</no><no>4971</no><no>4972</no><no>4973</no><no>4974</no><no>4975</no><no>4976</no><no>4977</no><no>4978</no><no>4981</no><no>4988</no><no>4990</no><no>4991</no><no>4994</no><no>4995</no><no>4997</no><no>4998</no><no>4999</no><no>5000</no><no>5001</no><no>5004</no><no>5005</no><no>5006</no><no>5009</no><no>5013</no><no>5015</no><no>5035</no><no>5050</no><no>5063</no><no>5064</no><no>5065</no><no>5066</no><no>5079</no><no>5094</no><no>5095</no><no>5096</no><no>5097</no><no>5098</no><no>5253</no><no>5255</no><no>5257</no><no>5456</no><no>5468</no><no>5524</no><no>5527</no><no>5529</no><no>5530</no><no>5531</no><no>5532</no><no>5533</no><no>5535</no><no>5548</no><no>5549</no><no>5555</no><no>5581</no><no>5583</no><no>5584</no><no>5585</no><no>5586</no><no>5587</no><no>5588</no><no>5589</no><no>5590</no><no>5591</no><no>5592</no><no>5595</no><no>5664</no><no>5665</no><no>5666</no><no>5670</no><no>5671</no><no>5672</no><no>5673</no><no>5674</no><no>5675</no><no>5676</no><no>5678</no><no>5679</no><no>5680</no><no>5681</no><no>5682</no><no>5683</no><no>5686</no><no>5687</no><no>5691</no><no>5694</no><no>5695</no><no>5696</no><no>5697</no><no>5698</no><no>5699</no><no>5700</no><no>5701</no><no>5703</no><no>5705</no><no>5706</no><no>5707</no><no>5711</no><no>5712</no><no>5713</no><no>5714</no><no>5715</no><no>5716</no><no>5717</no><no>5759</no><no>5760</no><no>5761</no><no>5762</no><no>5767</no><no>5773</no><no>5795</no><no>5802</no><no>5804</no><no>5805</no><no>5809</no><no>5810</no><no>5814</no><no>5822</no><no>5828</no><no>5836</no><no>5838</no><no>5839</no><no>5857</no><no>5858</no><no>5865</no><no>5876</no><no>5880</no><no>5881</no><no>5883</no><no>5885</no><no>5886</no><no>5889</no><no>5891</no><no>5892</no><no>5932</no><no>5934</no><no>5959</no><no>5964</no><no>5965</no><no>5966</no><no>5967</no><no>5968</no><no>5971</no><no>5972</no><no>5973</no><no>5974</no><no>5975</no><no>5991</no><no>5992</no><no>5993</no><no>6021</no><no>6026</no><no>6029</no><no>6035</no><no>6036</no><no>6044</no><no>6047</no><no>6066</no><no>6067</no><no>6068</no><no>6070</no><no>6113</no><no>6125</no><no>6126</no><no>6127</no><no>6128</no><no>6129</no><no>6132</no><no>6134</no><no>6135</no><no>6136</no><no>6138</no><no>6139</no><no>6141</no><no>6142</no><no>6143</no><no>6144</no><no>6146</no><no>6147</no><no>6148</no><no>6149</no><no>6151</no><no>6152</no><no>6153</no><no>6156</no><no>6158</no><no>6159</no><no>6162</no><no>6163</no><no>6165</no><no>6166</no><no>6170</no><no>6171</no><no>6173</no><no>6174</no><no>6175</no><no>6179</no><no>6180</no><no>6181</no><no>6182</no><no>6185</no><no>6186</no><no>6187</no><no>6188</no><no>6189</no><no>6190</no><no>6192</no><no>6193</no><no>6194</no><no>6195</no><no>6196</no><no>6198</no><no>6200</no><no>6201</no><no>6203</no><no>6205</no><no>6206</no><no>6208</no><no>6209</no><no>6210</no><no>6212</no><no>6214</no><no>6215</no><no>6216</no><no>6218</no><no>6219</no><no>6220</no><no>6222</no><no>6223</no><no>6224</no><no>6228</no><no>6229</no><no>6231</no><no>6234</no><no>6235</no><no>6237</no><no>6238</no><no>6240</no><no>6250</no><no>6251</no><no>6252</no><no>6253</no><no>6254</no><no>6255</no><no>6256</no><no>6257</no><no>6264</no><no>6289</no><no>6305</no><no>6306</no><no>6307</no><no>6308</no><no>6309</no><no>6310</no><no>6312</no><no>6313</no><no>6314</no><no>6318</no><no>6319</no><no>6324</no><no>6325</no><no>6329</no><no>6330</no><no>6332</no><no>6333</no><no>6334</no><no>6337</no><no>6345</no><no>6346</no><no>6348</no><no>6349</no><no>6350</no><no>6351</no><no>6353</no><no>6355</no><no>6356</no><no>6357</no><no>6358</no><no>6359</no><no>6360</no><no>6361</no><no>6362</no><no>6363</no><no>6364</no><no>6365</no><no>6367</no><no>6368</no><no>6369</no><no>6370</no><no>6372</no><no>6374</no><no>6375</no><no>6376</no><no>6377</no><no>6378</no><no>6379</no><no>6380</no><no>6381</no><no>6382</no><no>6385</no><no>6406</no><no>6420</no><no>6422</no><no>6429</no><no>6430</no><no>6436</no><no>6443</no><no>6444</no><no>6445</no><no>6446</no><no>6447</no><no>6448</no><no>6449</no><no>6451</no><no>6457</no><no>6462</no><no>6467</no><no>6470</no><no>6476</no><no>6482</no><no>6483</no><no>6484</no><no>6485</no><no>6486</no><no>6487</no><no>6488</no><no>6489</no><no>6490</no><no>6491</no><no>6492</no><no>6493</no><no>6497</no><no>6498</no><no>6510</no><no>6514</no><no>6517</no><no>6518</no><no>6519</no><no>6524</no><no>6525</no><no>6532</no><no>6537</no><no>6539</no><no>6544</no><no>6554</no><no>6555</no><no>6556</no><no>6557</no><no>6568</no><no>6579</no><no>6580</no><no>6581</no><no>6582</no><no>6587</no><no>6588</no><no>6594</no><no>6595</no><no>6596</no><no>6597</no><no>6598</no><no>6600</no><no>6601</no><no>6602</no><no>6603</no><no>6604</no><no>6605</no><no>6606</no><no>6607</no><no>6620</no><no>6621</no><no>6622</no><no>6623</no><no>6624</no><no>6638</no><no>6645</no><no>6646</no><no>6649</no><no>6654</no><no>6655</no><no>6657</no><no>6659</no><no>6661</no><no>6663</no><no>6665</no><no>6666</no><no>6667</no><no>6670</no><no>6674</no><no>6675</no><no>6676</no><no>6679</no><no>6685</no><no>6695</no><no>6727</no><no>6730</no><no>6731</no><no>6732</no><no>6733</no><no>6842</no><no>7063</no><no>7068</no><no>7088</no><no>7265</no><no>7285</no></video>
for $eachVideo in $Videos/no/text()
let $updatedDoi     := fn:concat($doiPre,$eachVideo)
let $VideoID        := collection("Video")/Video[VideoNumber=$eachVideo]/@ID/string()
let $VideoURI 			:= fn:concat($constants:VIDEO_DIRECTORY,$VideoID,".xml")
let $PHistoryUri		:= fn:concat($constants:PCOPY_DIRECTORY,$VideoID,".xml")
return
  (
    if(fn:doc-available($VideoURI))
    then
      let $doc := fn:doc($VideoURI)
      return
        if( $doc/Video/PublishInfo[VideoPublish/@active="yes"] )
        then xdmp:node-replace($doc/Video/PublishInfo/VideoPublish/DOI, <DOI>{$updatedDoi}</DOI>)
        else
        if( $doc/Video/PublishInfo[LivePublish/@active="yes"] )
        then xdmp:node-replace($doc/Video/PublishInfo/LivePublish/DOI, <DOI>{$updatedDoi}</DOI>)
        else xdmp:log(("======doi not replaced in =============", $VideoURI))
    else xdmp:log(("======document not available=============", $VideoURI))
    ,
    if(fn:doc-available($PHistoryUri))
    then
      let $doc := fn:doc($PHistoryUri)
      return
        if( $doc/Video/PublishInfo[VideoPublish/@active="yes"] )
        then xdmp:node-replace($doc/Video/PublishInfo/VideoPublish/DOI, <DOI>{$updatedDoi}</DOI>)
        else
        if( $doc/Video/PublishInfo[LivePublish/@active="yes"] )
        then xdmp:node-replace($doc/Video/PublishInfo/LivePublish/DOI, <DOI>{$updatedDoi}</DOI>)
        else xdmp:log(("======doi not replaced in =============", $PHistoryUri))
    else xdmp:log(("======document not available=============", $PHistoryUri))
   )    
